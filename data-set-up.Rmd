---
title: "data-exploration"
output: html_document
date: "2024-05-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, out.width = "100%", dpi = 300)
library(dplyr)
library(magrittr)
library(purrr)
library(DT)
library(ggplot2)
```

## load data

### SR LEGACY

```{r}
food <- read.csv("data/sr_legacy/food.csv") %>% 
  select(1,3,4)
nutrient <- read.csv("data/sr_legacy/nutrient.csv") %>% 
  select(1,2,3) %>% 
  rename("nutrient_id" = "id")
food_nutrient <- read.csv("data/sr_legacy/food_nutrient.csv") %>% 
  select(2,3,4)
food_portion <- read.csv("data/sr_legacy/food_portion.csv") %>% 
  select(2,4,7,8)
```

## Example analysis

### Select data of interest

```{r}
# STEP 0 - select units
unit_system <- "imperial"
# STEP 1 - select a food
food_selected <- "Candies, TWIZZLERS Strawberry Twists Candy"
select_a_food <- food %>% 
  filter(description == food_selected)
# STEP 2 - extract fdc_id
food_fdc_id <- select_a_food$fdc_id
# STEP 3 - select portion size
portion_data <- food_portion %>% 
  filter(fdc_id == food_fdc_id)
portion_amount <- 20
portion_multiplier <- portion_amount / portion_data$amount
portion_units <- "pieces 1.6oz"
# STEP 4 - determine nutritional content of food
nutrient_content_link <- food_nutrient %>% 
  filter(fdc_id == food_fdc_id) 
nutrient_link_list <- nutrient_content_link$nutrient_id
nutrient_content_type <- map_df(nutrient_link_list,  ~filter(nutrient, nutrient_id == .x))
nutrient_content_joined <- full_join(nutrient_content_link, nutrient_content_type)
nutrient_content <- nutrient_content_joined %>% 
  filter(unit_name != if_else(unit_system == "imperial", "kJ", "KCAL")) %>% 
  mutate(amount = amount*portion_multiplier)
```

### Present table

`r shiny::tags$h1(food_selected)`

```{r}
datatable(nutrient_content)
```


### Present graph

```{r}
ggplot(nutrient_content, aes(name, amount, fill = unit_name))+
  geom_col(color="black")+
  labs(title = food_selected)
```

